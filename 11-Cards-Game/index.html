<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Cards Game</title>
    
    <link rel="stylesheet" href="style.css">
    <style>
      
    </style>
</head>
<body>
    <nav class="nav">
        <a href="../index.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
        </a>
    </nav>
    <div class="game-container">
        <h1>🎮 Memory Cards Game</h1>
        
        <div class="game-stats">
            <div class="stat-item">
                <strong>Movimientos: <span id="moves">0</span></strong>
            </div>
            <div class="stat-item">
                <strong>Tiempo: <span id="time">00:00</span></strong>
            </div>
            <div class="stat-item">
                <strong>Parejas: <span id="matches">0</span>/8</strong>
            </div>
        </div>
        
        <div class="memory-grid" id="memory-grid"></div>
        
        <div class="controls">
            <button class="btn" id="reset-game">🔄 Reiniciar</button>
        </div>
    </div>
    
    <div class="victory-message" id="victory-message">
        <h2>🎉 Felicitaciones</h2>
        <p>Has completado el juego</p>
        <p>Movimientos: <span id="final-moves"></span></p>
        <p>Tiempo: <span id="final-time"></span></p>
        <button class="btn" onclick="$('#victory-message').fadeOut(); window.memoryGame.initializeGame();">Jugar de Nuevo</button>
    </div>
    <script src="/09-jQuery/js/jquery-3.7.1.min.js"></script>
    <script>
        class MemoryGame {
            constructor() {
                this.cards = [];
                this.flippedCards = [];
                this.matchedPairs = 0;
                this.totalPairs = 8;
                this.moves = 0;
                this.startTime = null;
                this.gameTimer = null;
                this.isProcessing = false;
                
                // 8 imágenes diferentes para las 8 parejas
                this.cardSymbols = [
                    'images/1.png',
                    'images/2.png', 
                    'images/3.png',
                    'images/4.png',
                    'images/5.png',
                    'images/6.png',
                    'images/7.png',
                    'images/8.png'
                ];
                
                this.initializeGame();
                this.attachEventListeners();
            }
            
            initializeGame() {
                // Crear pares de cartas (8 parejas = 16 cartas)
                this.cards = [];
                this.cardSymbols.forEach(symbol => {
                    this.cards.push(symbol, symbol);
                });
                
                // Mezclar cartas
                this.shuffleArray(this.cards);
                
                // Crear HTML de las cartas
                this.createCards();
                
                // Reset game state
                this.resetGameState();
            }
            
            createCards() {
                const grid = $('#memory-grid');
                grid.empty();
                
                this.cards.forEach((imagePath, index) => {
                    const card = $(`
                        <div class="memory-card" data-index="${index}" data-symbol="${imagePath}">
                            <div class="card-back">❓</div>
                            <div class="card-front">
                                <img src="${imagePath}" alt="Card ${index + 1}">
                            </div>
                        </div>
                    `);
                    grid.append(card);
                });
            }
            
            attachEventListeners() {
                const self = this;
                
                // Card click handler
                $(document).on('click', '.memory-card', function() {
                    if (self.isProcessing) return;
                    
                    const $card = $(this);
                    const index = parseInt($card.data('index'));
                    
                    if ($card.hasClass('flipped') || $card.hasClass('matched')) {
                        return;
                    }
                    
                    self.flipCard($card, index);
                });
                
                // Reset game button
                $('#reset-game').click(() => {
                    this.initializeGame();
                });
            }
            
            flipCard($card, index) {
                if (!this.startTime) {
                    this.startTimer();
                }
                
                $card.addClass('flipped');
                this.flippedCards.push({ element: $card, index: index, symbol: $card.data('symbol') });
                
                if (this.flippedCards.length === 2) {
                    this.moves++;
                    $('#moves').text(this.moves);
                    this.checkForMatch();
                }
            }
            
            checkForMatch() {
                this.isProcessing = true;
                
                const [card1, card2] = this.flippedCards;
                
                if (card1.symbol === card2.symbol) {
                    // Match found
                    setTimeout(() => {
                        card1.element.addClass('matched');
                        card2.element.addClass('matched');
                        
                        this.matchedPairs++;
                        $('#matches').text(this.matchedPairs);
                        
                        this.flippedCards = [];
                        this.isProcessing = false;
                        
                        if (this.matchedPairs === this.totalPairs) {
                            this.gameComplete();
                        }
                    }, 500);
                } else {
                    // No match
                    setTimeout(() => {
                        card1.element.removeClass('flipped');
                        card2.element.removeClass('flipped');
                        
                        this.flippedCards = [];
                        this.isProcessing = false;
                    }, 1000);
                }
            }
            
            gameComplete() {
                this.stopTimer();
                
                const finalTime = $('#time').text();
                const finalMoves = this.moves;
                
                $('#final-time').text(finalTime);
                $('#final-moves').text(finalMoves);
                
                setTimeout(() => {
                    $('#victory-message').fadeIn();
                }, 500);
            }
            
            startTimer() {
                this.startTime = Date.now();
                this.gameTimer = setInterval(() => {
                    const elapsed = Date.now() - this.startTime;
                    const minutes = Math.floor(elapsed / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    
                    $('#time').text(`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);
                }, 1000);
            }
            
            stopTimer() {
                if (this.gameTimer) {
                    clearInterval(this.gameTimer);
                    this.gameTimer = null;
                }
            }
            
            resetGameState() {
                this.flippedCards = [];
                this.matchedPairs = 0;
                this.moves = 0;
                this.startTime = null;
                this.isProcessing = false;
                
                $('#moves').text('0');
                $('#time').text('00:00');
                $('#matches').text('0');
                
                this.stopTimer();
            }
            
            resetGame() {
                this.resetGameState();
                $('.memory-card').removeClass('flipped matched');
                $('#victory-message').hide();
            }
            
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
        }
        
        // Initialize game when document is ready
        $(document).ready(() => {
            window.memoryGame = new MemoryGame();
        });
    </script>
</body>
</html>